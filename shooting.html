<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simple Shooting Game - JS Canvas</title>
  <style>
    :root{--w: min(900px,95vw)}
    body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP",sans-serif;display:flex;flex-direction:column;align-items:center;gap:12px;padding:18px;background:linear-gradient(180deg,#0b1220,#071126);color:#e8f0ff}
    h1{margin:0;font-size:18px}
    #gameWrap{width:var(--w);max-width:100%;display:flex;gap:12px}
    canvas{background:linear-gradient(#021226,#00111a);border-radius:12px;box-shadow:0 8px 20px rgba(0,0,0,0.6);display:block}
    .panel{width:300px;padding:12px;background:rgba(255,255,255,0.04);border-radius:12px}
    .row{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    button{padding:8px 12px;border-radius:8px;border:none;background:#1b87ff;color:white;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.12)}
    select,input{padding:6px;border-radius:8px;background:rgba(255,255,255,0.03);color:inherit;border:1px solid rgba(255,255,255,0.06)}
    .small{font-size:13px;color:rgba(255,255,255,0.8)}
    .big{font-size:16px;font-weight:700}
    .muted{color:rgba(255,255,255,0.6)}
    footer{margin-top:12px;color:rgba(255,255,255,0.55);font-size:13px}
    @media(max-width:900px){#gameWrap{flex-direction:column;align-items:center}.panel{width:100%}}
  </style>
</head>
<body>
  <h1>簡単シューティングゲーム（Canvas + JS）</h1>
  <div id="gameWrap">
    <canvas id="gameCanvas" width="640" height="800" aria-label="シューティングゲームの画面"></canvas>
    <div class="panel">
      <div class="row"><div class="big">スコア: <span id="score">0</span></div><div class="muted">ハイスコア: <span id="hi">0</span></div></div>
      <div class="row"><div>ライフ: <span id="lives">3</span></div><div>レベル: <span id="level">1</span></div></div>
      <div class="row"><button id="startBtn">スタート</button><button id="pauseBtn" class="ghost">一時停止</button></div>
      <div class="row"><label>難易度<select id="difficulty"><option value="easy">簡単</option><option value="normal" selected>普通</option><option value="hard">難しい</option></select></label></div>
      <div class="row"><label class="small">操作: ← → / A D で移動、スペースでショット</label></div>
      <hr style="border:none;border-top:1px solid rgba(255,255,255,0.06);margin:8px 0">
      <div class="small">機能</div>
      <ul class="small muted">
        <li>自機、弾、敵、敵弾、衝突判定</li>
        <li>レベル、ウェーブの進行で敵が増える</li>
        <li>ローカルストレージにハイスコア保存</li>
      </ul>
      <div style="margin-top:8px">
        <button id="resetHi" class="ghost">ハイスコアをリセット</button>
      </div>
    </div>
  </div>
  <footer>このファイルを開いてすぐに遊べます。変更要望（敵の種類、ボス、エフェクトなど）があれば教えてください！</footer>

<script>
(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const W = canvas.width, H = canvas.height;

  // UI
  const scoreEl = document.getElementById('score');
  const hiEl = document.getElementById('hi');
  const livesEl = document.getElementById('lives');
  const levelEl = document.getElementById('level');
  const startBtn = document.getElementById('startBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const difficultySel = document.getElementById('difficulty');
  const resetHi = document.getElementById('resetHi');

  // Game state
  let score = 0; let hi = Number(localStorage.getItem('simpleShooterHi') || 0);
  let lives = 3; let level = 1;
  let running = false; let paused = false;
  let keys = {};
  let bullets = []; let enemies = []; let enemyBullets = [];
  let spawnTimer = 0; let spawnInterval = 90; // frames
  let frame = 0;

  hiEl.textContent = hi;

  // Difficulty settings
  function difficultySettings(){
    const d = difficultySel.value;
    if(d==='easy'){ spawnInterval = 120; } else if(d==='normal'){ spawnInterval = 90; } else { spawnInterval = 60; }
  }
  difficultySel.addEventListener('change', difficultySettings);

  // Player
  const player = { x: W/2, y: H-70, r: 18, speed: 6, cooldown:0 };

  function resetGame(){
    score = 0; lives = 3; level = 1; bullets = []; enemies = []; enemyBullets = []; spawnTimer = 0; frame = 0; player.x = W/2; player.cooldown = 0; difficultySettings(); updateUI();
  }

  function startGame(){ resetGame(); running = true; paused = false; loop(); }
  function togglePause(){ if(!running) return; paused = !paused; pauseBtn.textContent = paused? '再開':'一時停止'; if(!paused) loop(); }

  // Input
  window.addEventListener('keydown', e=>{ keys[e.key.toLowerCase()] = true; if(e.key === ' '){ e.preventDefault(); } });
  window.addEventListener('keyup', e=>{ keys[e.key.toLowerCase()] = false; });

  // Entities
  function spawnEnemy(){
    const ex = Math.random()*(W-60)+30;
    const ey = -20;
    const sz = Math.random()*18+18;
    const hp = level >= 5 ? 3 : (Math.random()<0.2?2:1);
    const speed = 1 + Math.random()*0.6 + level*0.06;
    enemies.push({x:ex,y:ey,r:sz,hp,speed,dir:Math.random()<0.5?-1:1,shootCooldown: Math.floor(60+Math.random()*120)});
  }

  function playerShoot(){ if(player.cooldown>0) return; bullets.push({x:player.x,y:player.y-24,v:-10,r:4}); player.cooldown = 12; }

  function enemyShoot(e){ enemyBullets.push({x:e.x,y:e.y+e.r+6,v:4+(level*0.08),r:5}); }

  // Collisions
  function hitTest(a,b){ const dx=a.x-b.x, dy=a.y-b.y; return dx*dx+dy*dy <= (a.r+b.r)*(a.r+b.r); }

  // Game loop
  function loop(){ if(!running) return; if(paused) return; update(); draw(); requestAnimationFrame(loop); }

  function update(){ frame++;
    // player movement
    if(keys['arrowleft'] || keys['a']) player.x -= player.speed;
    if(keys['arrowright'] || keys['d']) player.x += player.speed;
    player.x = Math.max(20, Math.min(W-20, player.x));

    if(keys[' '] || keys['space']) playerShoot();
    if(player.cooldown>0) player.cooldown--;

    // bullets
    for(let i=bullets.length-1;i>=0;i--){ bullets[i].y += bullets[i].v; if(bullets[i].y < -10) bullets.splice(i,1); }

    // enemy bullets
    for(let i=enemyBullets.length-1;i>=0;i--){ enemyBullets[i].y += enemyBullets[i].v; if(enemyBullets[i].y > H+10) enemyBullets.splice(i,1); }

    // enemies
    for(let i=enemies.length-1;i>=0;i--){
      const e = enemies[i];
      e.y += e.speed; e.x += Math.sin((frame+ i)*0.02)*0.8*e.dir;
      e.shootCooldown--;
      if(e.shootCooldown <= 0){ enemyShoot(e); e.shootCooldown = Math.floor(80 - level*2 + Math.random()*80); }
      if(e.y > H + 40){ enemies.splice(i,1); lives--; updateUI(); if(lives<=0) gameOver(); }
    }

    // bullet hits enemy
    for(let i=enemies.length-1;i>=0;i--){
      const e = enemies[i];
      for(let j=bullets.length-1;j>=0;j--){
        if(hitTest(e, bullets[j])){
          bullets.splice(j,1);
          e.hp--;
          if(e.hp<=0){ enemies.splice(i,1); score += 100; updateUI(); break; }
        }
      }
    }

    // enemy bullet hits player
    for(let i=enemyBullets.length-1;i>=0;i--){ if(hitTest(enemyBullets[i], player)){ enemyBullets.splice(i,1); lives--; updateUI(); if(lives<=0) gameOver(); }}

    // enemies collide with player
    for(let i=enemies.length-1;i>=0;i--){ if(hitTest(enemies[i], player)){ enemies.splice(i,1); lives--; updateUI(); if(lives<=0) gameOver(); }}

    // spawn
    spawnTimer--;
    if(spawnTimer <= 0){ spawnTimer = Math.max(12, spawnInterval - level*4); const count = 1 + Math.floor(Math.random()*Math.min(3, Math.floor(level/2)+1)); for(let k=0;k<count;k++) spawnEnemy(); }

    // level up
    if(frame % 1800 === 0){ level++; updateUI(); }

    // increase difficulty gradually
    if(frame % 600 === 0 && spawnInterval > 30){ spawnInterval = Math.max(30, spawnInterval - 2); }
  }

  function draw(){
    ctx.clearRect(0,0,W,H);

    // stars background
    drawStars();

    // player
    drawPlayer();

    // bullets
    bullets.forEach(b=>{ ctx.beginPath(); ctx.arc(b.x,b.y,b.r,0,Math.PI*2); ctx.fillStyle='white'; ctx.fill(); });

    // enemy bullets
    enemyBullets.forEach(b=>{ ctx.beginPath(); ctx.arc(b.x,b.y,b.r,0,Math.PI*2); ctx.fillStyle='orange'; ctx.fill(); });

    // enemies
    enemies.forEach(e=>{
      ctx.save(); ctx.translate(e.x,e.y);
      // body
      ctx.beginPath(); ctx.arc(0,0,e.r,0,Math.PI*2); ctx.fillStyle = e.hp>1 ? 'salmon' : 'tomato'; ctx.fill();
      // eye
      ctx.beginPath(); ctx.arc(-e.r*0.25, -e.r*0.2, Math.max(2, e.r*0.2), 0, Math.PI*2); ctx.fillStyle='rgba(0,0,0,0.6)'; ctx.fill();
      ctx.restore();
    });

    // HUD
    ctx.fillStyle='rgba(255,255,255,0.08)'; ctx.fillRect(8,8,180,36);
    ctx.fillStyle='white'; ctx.font='14px sans-serif'; ctx.fillText('スコア: '+score, 16, 30);
  }

  let starData = [];
  function initStars(){ starData = []; for(let i=0;i<120;i++){ starData.push({x:Math.random()*W, y:Math.random()*H, s:Math.random()*1.4+0.3}); } }
  function drawStars(){ ctx.fillStyle='#00151f'; ctx.fillRect(0,0,W,H); for(const s of starData){ s.y += 0.3; if(s.y>H) s.y = 0; ctx.beginPath(); ctx.arc(s.x, s.y, s.s,0,Math.PI*2); ctx.fillStyle='rgba(200,230,255,'+(0.4+Math.random()*0.6)+')'; ctx.fill(); } }

  function drawPlayer(){ ctx.save(); ctx.translate(player.x, player.y);
    // ship body
    ctx.beginPath(); ctx.moveTo(0,-22); ctx.lineTo(14,14); ctx.lineTo(0,6); ctx.lineTo(-14,14); ctx.closePath(); ctx.fillStyle='#66d3ff'; ctx.fill();
    ctx.beginPath(); ctx.ellipse(0,4,10,6,0,0,Math.PI*2); ctx.fillStyle='#0b9bdc'; ctx.fill();
    ctx.restore();
  }

  function updateUI(){ scoreEl.textContent = score; livesEl.textContent = lives; levelEl.textContent = level; if(score>hi){ hi = score; localStorage.setItem('simpleShooterHi', String(hi)); hiEl.textContent = hi; } }

  function gameOver(){ running = false; alert('ゲームオーバー\nスコア: '+score); }

  // UI bindings
  startBtn.addEventListener('click', ()=>{ if(!running){ startGame(); } else { resetGame(); } startBtn.textContent = running? 'リセット':'スタート'; });
  pauseBtn.addEventListener('click', ()=>{ togglePause(); });
  resetHi.addEventListener('click', ()=>{ localStorage.removeItem('simpleShooterHi'); hi = 0; hiEl.textContent = hi; });

  // auto-start small demo
  initStars(); draw();

})();
</script>
</body>
</html>
